{
	"nodes":[
		{"id":"dev_card_1","type":"text","text":"# 🔧 개발자 참고사항 (2024 구현 현황)\n\n## 기술 스택 (완료)\n- **Next.js 14.2.16** (App Router)\n- **TypeScript 5** (완전 타입 안전성)\n- **Tailwind CSS v3** (커스텀 Careon 디자인)\n- **Supabase PostgreSQL** (데이터베이스)\n- **React Hook Form + Zod** (폼 검증)\n\n## FormData 타입 구조 (구현 완료)\n```typescript\ntype FormData = {\n  // Step 1 - 대표자 정보\n  ownerName: string\n  birthDate: string (6자리)\n  birthGender: string (1자리)\n  \n  // Step 1.5 - 토스페이 동의\n  agreeTosspay: string | boolean\n  \n  // Step 2 - 연락처 & 사업자 정보\n  phoneNumber: string\n  businessName: string\n  businessNumber: string (10자리)\n  \n  // Step 3 - 매장 정보\n  storeName: string\n  storeAddress: string\n  storePostcode: string\n  storeArea: string\n  \n  // 나머지 단계들...\n}\n```\n\n## 컴포넌트 아키텍처 (완료)\n- **CareonContainer**: 페이지 레이아웃\n- **CareonButton**: 브랜드 버튼\n- **CareonInput**: 입력 필드\n- **CareonBottomSheet**: 바텀시트\n- **CareonCarrierSelect**: 통신사 선택","x":0,"y":300,"width":800,"height":1380},
		{"id":"dev_card_2","type":"text","text":"# 📄 문서 처리 시스템\n\n## contract_documents 테이블\n\n### 문서 타입별 매핑\n- `business_reg` ← 사업자등록증\n- `id_card` ← 신분증\n- `bank_book` ← 통장사본\n- `business_license` ← 영업신고증\n- `resident_cert` ← 주민등록 초본\n- `store_photo` ← 사업장 사진\n\n### 제약 조건\n```sql\nCREATE UNIQUE INDEX idx_contract_doc_unique\nON contract_documents(contract_id, doc_type)\nWHERE verified IS TRUE;\n```\n\n**OCR 결과:** `extracted_data` JSONB 필드에 저장","x":900,"y":300,"width":800,"height":1040},
		{"id":"dev_card_3","type":"text","text":"# ⚙️ 서비스 구성 관리\n\n## contract_items 테이블 (단일 진실 소스)\n\n### 제품/서비스 매핑\n- 인터넷 1년 무료 → `product_id`, `discount_rate: 100%`\n- AI CCTV 1년 무료 → `product_id`, `discount_rate: 100%`  \n- 배달앱 가입 대행 → 기타 서비스 등록\n\n## contracts.service_config (JSONB)\n```json\n{\n  \"internet\": {\"plan\": \"U+ giga\", \"speed\": \"500M\"},\n  \"cctv\": {\"count\": 4, \"nvr\": \"8ch\"}\n}\n```\n\n### 금액 계산\n`total_monthly_fee` = contract_items 합계 (자동 계산)","x":1800,"y":300,"width":800,"height":1200},
		{"id":"dev_card_4","type":"text","text":"# 🎯 UI/UX 구현 가이드\n\n## 공통 클래스 사용\n- **입력폼:** `glass-input`\n- **버튼:** `careon-btn-primary`\n- **선택 버튼:** 기존 토글 컴포넌트 재사용\n\n## 파일 업로드\n- **용량 한도:** 100MB까지 허용\n- **안내 메시지:** \"큰 파일도 괜찮아요\"\n- **아이콘:** 📎 이모지 사용\n\n## 마이크로카피 톤앤매너\n- **Toss 스타일:** 친근하고 안심시키는 톤\n- **저항 최소화:** \"언제든 삭제할 수 있어요\"\n- **진행 유도:** \"정확할수록 일정이 빨라져요\"","x":2700,"y":300,"width":800,"height":1200},
		{"id":"dev_card_5","type":"text","text":"# 🔄 비즈니스 로직\n\n## 조건부 표시 로직\n\n### 14번 마지막 마케팅 질문\n**표시 조건:** (5번 배달앱 거절 OR 9번 인터넷/CCTV 거절)\n```javascript\nif (deliveryAppRefused || internetCctvRefused) {\n  showFinalMarketingQuestion = true;\n}\n```\n\n## 계약 생성 플로우\n1. **careon_applications** 먼저 생성\n2. **contracts** 생성 (customer_id 매핑)\n3. **contract_items** 선택한 서비스별 생성\n4. **contract_documents** 업로드된 파일별 생성\n\n## 상태 관리\n- 서류 업로드 전: `status='quoted'`\n- 전자서명 완료 후: `approved` → `active` 자동 전이","x":3600,"y":300,"width":800,"height":1240},
		{"id":"dev_card_6","type":"text","text":"# 🗄️ 데이터베이스 마이그레이션\n\n## 중복 컬럼 제거 (문서 일원화)\n```sql\n-- 1) 이미지 컬럼 제거(문서 일원화)\nALTER TABLE public.contracts\n  DROP COLUMN IF EXISTS bank_account_image,\n  DROP COLUMN IF EXISTS id_card_image,\n  DROP COLUMN IF EXISTS business_registration_image;\n\n-- 2) CCTV 수량 정수화\nALTER TABLE public.contracts\n  ALTER COLUMN cctv_count TYPE INTEGER \n  USING (NULLIF(cctv_count, '')::integer);\n\n-- 3) 서비스 설정 JSONB 추가\nALTER TABLE public.contracts\n  ADD COLUMN IF NOT EXISTS service_config JSONB \n  DEFAULT '{}'::jsonb;\n\n-- 4) 문서 유니크(최신본) 보장\nCREATE UNIQUE INDEX IF NOT EXISTS idx_contract_doc_unique\nON public.contract_documents(contract_id, doc_type)\nWHERE verified IS TRUE;\n```","x":4500,"y":300,"width":900,"height":1140},
		{"id":"dev_card_7","type":"text","text":"# 💡 심화 개발 가이드\n\n## 금액 계산 자동화\n```sql\n-- total_monthly_fee 자동 계산 트리거\nCREATE OR REPLACE FUNCTION update_contract_total()\nRETURNS TRIGGER AS $$\nBEGIN\n    UPDATE contracts \n    SET total_monthly_fee = (\n        SELECT COALESCE(SUM(fee), 0)\n        FROM contract_items\n        WHERE contract_id = NEW.contract_id\n    )\n    WHERE id = NEW.contract_id;\n    RETURN NEW;\nEND;\n$$ LANGUAGE plpgsql;\n\nCREATE TRIGGER trigger_update_contract_total\nAFTER INSERT OR UPDATE OR DELETE ON contract_items\nFOR EACH ROW EXECUTE FUNCTION update_contract_total();\n```\n\n## 파일 업로드 제한\n- **최대 용량:** 100MB\n- **허용 형식:** PDF, JPG, PNG, WEBP\n- **OCR 대상:** business_reg, id_card\n- **보안:** S3 pre-signed URL 사용","x":5500,"y":300,"width":800,"height":1220},
		{"id":"dev_card_8","type":"text","text":"# 🔐 보안 & 규정 준수\n\n## 개인정보 처리\n- **수집 목적:** 사업자 신원 확인\n- **보관 기간:** 계약 종료 후 5년\n- **암호화:** 민감정보 AES-256\n- **접근 제한:** RBAC 기반 권한 관리\n\n## GDPR/개정법 대응\n```javascript\n// 개인정보 삭제 요청 처리\nconst deletePersonalData = async (customerId) => {\n  await db.transaction(async (trx) => {\n    // 개인정보 마스킹\n    await trx('careon_applications')\n      .where('customer_id', customerId)\n      .update({\n        name: '삭제된 고객',\n        birth_date: null,\n        phone_number: '***-****-****'\n      });\n    \n    // 문서 파일 삭제\n    await deleteS3Files(customerId);\n  });\n};\n```\n\n## 전자서명 법적 효력\n- **전자서명법** 준수\n- **IP 주소, 디바이스 정보** 저장\n- **서명 시점** 타임스탬프","x":6400,"y":300,"width":800,"height":1380},
		{"id":"dev_card_9","type":"text","text":"# 🚀 성능 최적화\n\n## 인덱스 전략\n```sql\n-- 가입신청 조회 최적화\nCREATE INDEX idx_applications_status_created\nON careon_applications(status, created_at);\n\n-- 계약 검색 최적화\nCREATE INDEX idx_contracts_customer_status\nON contracts(customer_id, status);\n\n-- 문서 검색 최적화\nCREATE INDEX idx_documents_contract_type\nON contract_documents(contract_id, doc_type, verified);\n```\n\n## 캐싱 전략\n- **업종 리스트:** Redis 캐시 (1일)\n- **제품 정보:** Application Cache\n- **고객 세션:** JWT + Redis\n\n## API 응답 최적화\n- **페이지네이션:** 필수 적용\n- **필드 선택:** GraphQL 또는 Sparse Fields\n- **압축:** gzip 응답","x":7300,"y":300,"width":800,"height":1340},
		{"id":"c9585afe31e4f394","type":"text","text":"# 11. 필수 서류 업로드\n\n## 필수 서류를 업로드해주세요\n\n**사업자등록증**\n[파일 업로드] 📎\n\n**대표자 신분증**\n[파일 업로드] 📎\n\n**통장 사본**\n[파일 업로드] 📎","x":5840,"y":-1235,"width":500,"height":450},
		{"id":"d0696b0f42f5g405","type":"text","text":"# 12. 조건부 서류\n\n## 해당되는 분만\n\n**영업신고증** (해당 업종)\n[파일 업로드] 📎\n\n**주민등록 초본** (개명 이력 있는 경우)\n[파일 업로드] 📎","x":6500,"y":-1210,"width":500,"height":400},
		{"id":"e1707c1053g516","type":"text","text":"# 13. 사업장 사진\n\n## 간판 1장 + 매장 내부 1장\n\n**간판 사진** (필수)\n[파일 업로드] 📎\n\n**내부 사진** (필수)\n[파일 업로드] 📎\n\n*추가 사진은 선택이에요*","x":7120,"y":-1262,"width":500,"height":505},
		{"id":"f2818d2164h627","type":"text","text":"# 14. 마지막 마케팅 질문\n\n## 🚨 중요 안내\n\n**인터넷/CCTV/배달앱 가입에 동의하시겠습니까?**\n\n⚠️ **주의:** 거절 선택시 재신청이 불가능합니다\n\n[선택버튼] 동의해요 / 거절해요\n\n*※ 5번과 9번 답 중 하나라도 거절한 경우에만 표시*","x":7820,"y":-1285,"width":600,"height":550},
		{"id":"g3929e3275i738","type":"text","text":"# 15. 최종 검토 및 제출\n\n## 제출 전 마지막 확인\n\n[체크박스] 개인정보 수집·이용 동의\n[체크박스] 마케팅 수신 (선택)\n[체크박스] 제출 자료 확인 완료\n\n[버튼] 1분 만에 접수하기","x":8540,"y":-1234,"width":500,"height":450},
		{"id":"h4030f4386j849","type":"text","text":"# 16. ✅ 완료\n\n## 접수 완료!\n\n**보통 오늘 안에 연락드려요**\n\n📱 카카오톡으로 진행 현황을 알려드릴게요\n\n감사합니다! 🎉","x":9200,"y":-1210,"width":500,"height":400},
		{"id":"7ef6ecd942c2c526","type":"text","text":"# 6. 방문 설치 여부\n\n## 기사님 방문 설치가 편하신가요?\n\n**설치 방식 선택**\n❌ **DB 필드 추가 필요:** `installation_preference` `text` (careon_applications)\n\n[선택버튼]\n- 방문 설치 원해요 (\"visit\")\n- 직접 할게요 (\"self\")","x":830,"y":-800,"width":500,"height":710},
		{"id":"6625de0c0fff82cf","type":"text","text":"# 7. 설치 장소\n\n## 주소를 입력해주세요\n\n**설치 장소 주소**\n`business_address` `text` (careon_applications)\n`installation_address` `text` (contracts)\n\n```\n[입력폼] 플레이스홀더: \"도로명 주소로 입력\"\n```\n\n*정확할수록 일정이 빨라져요*","x":1430,"y":-800,"width":500,"height":710},
		{"id":"3bdb70025469b9e5","type":"text","text":"# 8. 설치 환경 확인\n\n## 설치 장소에 이미 인터넷이 있나요?\n\n**기존 서비스 보유 현황**\n`existing_services` `jsonb` (careon_applications)\n`{\"internet\": boolean, \"cctv\": boolean}`\n\n[선택버튼] 있어요 / 없어요\n\n## CCTV는 설치되어 있나요?\n\n[선택버튼] \n있어요 \n/ 없어요","x":2030,"y":-800,"width":500,"height":710},
		{"id":"b8474fed20d3e293","type":"text","text":"# 10. 🎉 1차 가입 완료!\n\n## 훌륭해요! 3장만 있으면 끝나요\n\n📍 **중요:** 매장과 가까이 있어야 해요\n\n**체크리스트:**\n✅ 사업자등록증\n✅ 신분증  \n✅ 통장 \n\n*사진으로 찍어 올리셔도 돼요. 큰 파일도 괜찮아요*","x":5040,"y":-1460,"width":600,"height":500},
		{"id":"3d93f52f61965466","type":"text","text":"# 4. 사업자 구분\n\n## 사업자 등록은...\n\n**사업 상태**\n`startup_period` `text` (careon_applications)\n`business_status` `text` (careon_applications)\n\n[선택버튼]\n- 막 시작할 예정 (\"preparing\")\n- 이미 운영 중 (\"existing\")\n\n*상황에 맞춰 서류를 딱 필요한 만큼만 입력할 수 있게 해드릴게요*","x":-360,"y":-655,"width":500,"height":750},
		{"id":"488574e604cc5bf6","type":"text","text":"# 5. 배달앱 가입 대행\n\n## 배달앱(배민/요기요/쿠팡이츠) 가입 대행이 필요하신가요?\n\n**배달앱 서비스 선택**\n`existing_services` `jsonb` (careon_applications)\n⚠️ **추가 필요:** `{\"delivery_app\": boolean}`\n\n## 로고\n- 배민 로고 url \n```\nhttps://pkehcfbjotctvneordob.supabase.co/storage/v1/object/public/care-on/1.jpg\n```\n\n- 요기요 로고 url\n```\nhttps://pkehcfbjotctvneordob.supabase.co/storage/v1/object/public/care-on/2.jpg\n```\n- 쿠팡이츠 로고 url\n```\nhttps://pkehcfbjotctvneordob.supabase.co/storage/v1/object/public/care-on/3.jpg\n```\n\n[선택버튼]\n- 필요해요 (true)\n- 지금은 아니에요 (false)","x":240,"y":-880,"width":500,"height":1020},
		{"id":"a7363dec19ca7e82","type":"text","text":"# 9. (둘 다 ‘없어요’)일 경우 \n\n오늘 가입하시는 분께*\n**✨인터넷+AI CCTV 1년 무료✨ 옵션이 있어요**\n\n## 바로 혜택 안내 받아보실까요?\n\n⏰ **timestamp: DD +2DAY까지만!**\n\n[선택버튼] 좋아요 / 싫어요","x":3288,"y":-1920,"width":540,"height":520},
		{"id":"ba4580f3aed7c160","type":"text","text":"# 9. (CCTV만 ‘없어요’일 경우)\n\n*없다면, 오늘 가입하시는 분께*\nAI CCTV 1년 무료  옵션이 있어요**\n\n## 바로 혜택 안내 받아보실까요?\n\n⏰ **timestamp: DD +2DAY까지만!**\n\n[선택버튼] 좋아요 / 싫어요","x":3278,"y":-1202,"width":526,"height":570},
		{"id":"67f04802c366b05e","type":"text","text":"","x":4941,"y":-303,"width":250,"height":60},
		{"id":"9b3aa8a8c5b7274b","type":"text","text":"# 단 100명\n\n- AI지능형 CCTV (KT) 4대'\n- 500M 기가라이트 초고속 인터넷\n\n\n# 1년 무료\n\n","x":4070,"y":-1235,"width":660,"height":512},
		{"id":"123d6b06cf4e0382","type":"text","text":"# (모두 ‘있어요’인 경우)\n\n좋아요! \n\n최대한 빠른 일정을 확인할게요. \n\n(로딩 스피너)\n1) 전체 예약 확인중\"\n2) 주소지 기준 기사님 탐색중\n3) 내 업종에 맞는 기사님 찾는 중","x":4070,"y":-445,"width":642,"height":560},
		{"id":"fc3362191a292963","type":"text","text":"# 3. 업종 확인\n\n## 어떤 업종에서 시작하시나요?\n\n**업종 선택**\n`business_type` `integer` (careon_applications)\n\n[선택버튼] \n- 요식업 (ID: 1-3)\n- 학원 (ID: 4-5)\n- 일반 소매 (ID: 6-10)\n- 기타 (ID: 11-16)\n\n*업종에 따라 설치 시간이 조금 달라져요*","x":-1080,"y":-84,"width":500,"height":750},
		{"id":"welcome_message_card","type":"text","text":"# 1.1 비대면 카드 가맹 신청 동의\n\n## 🎉 토스페이 가맹점 신청을 환영합니다!\n\n**비대면 카드 가맹 신청 전 아래 안내사항을 확인해 주세요.**\n\n### ✨ 특별 혜택\n- **인터넷 1년 무료** (500Mbps 초고속)\n- **AI CCTV 1년 무료** (4대 설치)\n- **배달앱 가입 대행** (배민/요기요/쿠팡이츠)\n\n### 📋 준비할 서류\n- 사업자등록증\n- 신분증\n- 통장사본\n- 매장 사진\n\n\n\n### 🔒 필수 동의사항\n[체크박스] **비대면 서비스 이용을 위한 개인정보 수집 및 이용동의 (필수)**\n\n*토스페이 가맹점 가입 대행을 위한 법적 동의입니다*\n\n### 🕐 소요시간\n**단 3분이면 완료!**\n\n[버튼] 동의하고 시작하기","x":-3500,"y":-456,"width":760,"height":1447},
		{"id":"831cd824f199fe4e","type":"text","text":"# 2. 기본정보 입력\n\n## 본인 확인용으로만 쓰이고, 언제든 삭제할 수 있어요\n\n**이름** \n`name` `text` (careon_applications)\n\n```\n[입력폼] 플레이스홀더: \"홍길동\"\n```\n\n**생년월일** \n`birth_date` `text` (careon_applications)\n```\n[입력폼] 예: 1993-07-15\n```\n\n**연락처** ⚠️ **필수 추가 필요**\n`phone_number` `text` (careon_applications)\n```\n[입력폼] 플레이스홀더: \"010-1234-5678\"\n```","x":-1980,"y":-150,"width":500,"height":950},
		{"id":"7bc764a4c8e902f2","type":"text","text":"# 1. 시작\n\n**케어온 서비스 가입을 환영합니다.**\n\n지금 바로 가입을 시작하세요.\n\n[버튼] 가입 시작\n\n![[14987.preview-1.jpg]]","x":-5880,"y":-480,"width":900,"height":1447}
	],
	"edges":[
		{"id":"eb07d56cc192b205","fromNode":"7bc764a4c8e902f2","fromSide":"right","toNode":"welcome_message_card","toSide":"left"},
		{"id":"3834e7d092e2c3a5","fromNode":"831cd824f199fe4e","fromSide":"right","toNode":"fc3362191a292963","toSide":"left"},
		{"id":"8dd2ad0be4d2ecfd","fromNode":"fc3362191a292963","fromSide":"right","toNode":"3d93f52f61965466","toSide":"left"},
		{"id":"8ae9f135bb822089","fromNode":"3d93f52f61965466","fromSide":"right","toNode":"488574e604cc5bf6","toSide":"left"},
		{"id":"85d57cdb7793819a","fromNode":"488574e604cc5bf6","fromSide":"right","toNode":"7ef6ecd942c2c526","toSide":"left"},
		{"id":"37d1e174076168df","fromNode":"7ef6ecd942c2c526","fromSide":"right","toNode":"6625de0c0fff82cf","toSide":"left"},
		{"id":"88902540d9ae4987","fromNode":"6625de0c0fff82cf","fromSide":"right","toNode":"3bdb70025469b9e5","toSide":"left"},
		{"id":"9d957e8ff51f396e","fromNode":"3bdb70025469b9e5","fromSide":"right","toNode":"a7363dec19ca7e82","toSide":"left"},
		{"id":"b1f79g8d96l06b1","fromNode":"b8474fed20d3e293","fromSide":"right","toNode":"c9585afe31e4f394","toSide":"left"},
		{"id":"c2g80h9ea7m17c2","fromNode":"c9585afe31e4f394","fromSide":"right","toNode":"d0696b0f42f5g405","toSide":"left"},
		{"id":"d3h91i0fb8n28d3","fromNode":"d0696b0f42f5g405","fromSide":"right","toNode":"e1707c1053g516","toSide":"left"},
		{"id":"e4i02j1gc9o39e4","fromNode":"e1707c1053g516","fromSide":"right","toNode":"f2818d2164h627","toSide":"left"},
		{"id":"f5j13k2hd0p40f5","fromNode":"f2818d2164h627","fromSide":"right","toNode":"g3929e3275i738","toSide":"left"},
		{"id":"g6k24l3ie1q51g6","fromNode":"g3929e3275i738","fromSide":"right","toNode":"h4030f4386j849","toSide":"left"},
		{"id":"5f1f358132cc0481","fromNode":"3bdb70025469b9e5","fromSide":"right","toNode":"ba4580f3aed7c160","toSide":"left"},
		{"id":"5f9a7e267636b91e","fromNode":"a7363dec19ca7e82","fromSide":"right","toNode":"9b3aa8a8c5b7274b","toSide":"left"},
		{"id":"97ccb49316d77e66","fromNode":"ba4580f3aed7c160","fromSide":"right","toNode":"9b3aa8a8c5b7274b","toSide":"left"},
		{"id":"3c9befa6acbe444c","fromNode":"3bdb70025469b9e5","fromSide":"right","toNode":"123d6b06cf4e0382","toSide":"left"},
		{"id":"welcome_to_basic_info","fromNode":"welcome_message_card","fromSide":"right","toNode":"831cd824f199fe4e","toSide":"left"}
	]
}